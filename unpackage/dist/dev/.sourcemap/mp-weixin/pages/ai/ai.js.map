{"version":3,"file":"ai.js","sources":["pages/ai/ai.vue","../../../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWkvYWkudnVl"],"sourcesContent":["<template>\n\t<view class=\"route-max\" :style=\"{height:screenHeight + 'px'}\">\n\t\t<!-- 内容展示框 -->\n\t\t<view class=\"route-content-show\">\n\t\t\t<scroll-view scroll-y=\"true\" class=\"route-scroll-Y\" lower-threshold=\"50\" :scroll-top=\"scrollTop\" @scroll=\"scrolList\" :scroll-anchoring=\"true\">\n\t\t\t\t<view v-for=\"(item,index) in contentList\" :key=\"index\">\n\t\t\t\t\t<!-- 用户输入的信息内容框 -->\n\t\t\t\t\t<view class=\"route-user-box\" v-if=\"item.type == 'user'\">\n\t\t\t\t\t\t<!-- 输入的内容框 -->\n\t\t\t\t\t\t<view class=\"route-input-box\">\n\t\t\t\t\t\t\t<view class=\"route-input-content\">{{item.text}}</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<!-- 用户头像 -->\n\t\t\t\t\t\t<image src=\"/static/user.jpg\" mode=\"widthFix\"\n\t\t\t\t\t\t\tstyle=\"width:70rpx;height:70rpx;border-radius:50%;\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t\t<!-- AI回复的信息内容框 -->\n\t\t\t\t\t<view class=\"route-Ai-box\" v-if=\"item.type == 'AI'\">\n\t\t\t\t\t\t<!-- AI头像 -->\n\t\t\t\t\t\t<image src=\"/static/index/logo.png\" mode=\"widthFix\"\n\t\t\t\t\t\t\tstyle=\"width:70rpx;height:70rpx;border-radius:50%;\"></image>\n\t\t\t\t\t\t<!-- AI回复的内容框 -->\n\t\t\t\t\t\t<view class=\"route-Ai-input\">\n\t\t\t\t\t\t\t<!-- 光标加载动画 -->\n\t\t\t\t\t\t\t<view class=\"smaa-user-cursor\" v-if=\"item.cursorInex\"></view>\n\t\t\t\t\t\t\t<!-- 回复的内容 -->\n\t\t\t\t\t\t\t<view class=\"route-Ai-content\">\n\t\t\t\t\t\t\t\t{{ item.showText || '' }}\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view style=\"height: 140rpx;\"></view> <!-- 底部留白，确保内容不被输入框遮挡 -->\n\t\t\t</scroll-view>\n\t\t</view>\n\t\t\n\t\t<!-- 固定在底部的输入框 -->\n\t\t<view class=\"route-bottom-fixed\" >\n\t\t\t<view class=\"route-bottom-box\">\n\t\t\t\t<input type=\"text\" v-model=\"information\" placeholder=\"输入你想资讯的问题\" class=\"route-bottom-input\" \n\t\t\t\t\t@confirm=\"clickSending\" />\n\t\t\t\t<up-icon v-if=\"showSendIcon\" name=\"arrow-up\" @tap=\"clickSending()\" size=\"30px\" tyle=\"width:60rpx;height:60rpx;margin-left: 15rpx;\"></up-icon>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, onMounted, nextTick, computed } from 'vue'\nimport { askAi } from '../../api/api.js'\n\n// 响应式数据\nconst information = ref('')\nconst contentList = ref([])\nconst scrollTop = ref(0)\nconst old = ref({ scrollTop: 0 })\nconst screenHeight = ref(0)\nconst currentTypingIndex = ref(-1) // 当前正在打字效果的AI消息索引\n\n\n// 控制发送按钮图标显示的变量\nconst showSendIcon = computed(() => {\n\t// 找到最后一条AI消息\n\tlet aiIndex = -1;\n\tfor (let i = contentList.value.length - 1; i >= 0; i--) {\n\t\tif (contentList.value[i].type === 'AI') {\n\t\t\taiIndex = i;\n\t\t\tbreak;\n\t\t}\n\t}\n\t// 只有一条AI消息且是第一条，始终显示按钮\n\tif (aiIndex === 0) return true;\n\t// 其余AI消息未打字完毕时隐藏按钮\n\tif (aiIndex !== -1) return !!contentList.value[aiIndex].typingComplete;\n\t// 没有AI消息时允许发送\n\treturn true;\n});\n\n// 生命周期钩子\nonMounted(() => {\n\t// 同步获取设备屏幕的高度\n\tconst windowInfo = uni.getWindowInfo()\n\tscreenHeight.value = windowInfo.windowHeight\n\texecute()\n})\n\n// 方法\nconst execute = () => {\n\t// 默认AI回复\n\tcontentList.value.push({\n\t\ttype: 'AI',\n\t\treply: `您好，我是湖南高校推荐官，您可以按以下问我：\\n• 湖南有哪些本科/专科高校呀？\\n• XX大学的特色专业是什么？\\n• 湖南高校近年的录取分数线是多少？\\n• 某所大学的校园环境、宿舍条件怎么样？\\n• 湖南高校的招生政策（比如省内/省外招生计划）有哪些？\\n• XX专业在湖南哪些高校实力较强？\\n• 湖南高校的奖学金、助学金政策是什么？\\n• 高校毕业生就业情况（比如就业率、热门就业方向）如何？\\n有任何想了解的，随时问我呀~`,\n\t\tshowText: '', // 显示的文字\n\t\tcursorInex: false,\n\t\ttypingComplete: false // 打字是否完成\n\t})\n\tstartTypingEffect(contentList.value.length - 1)\n}\n\nconst clickSending = () => {\n\tif (!information.value.trim()) {\n\t\tuni.showToast({\n\t\t\ttitle: '请输入想资讯的内容',\n\t\t\ticon: 'none',\n\t\t\tduration: 2000\n\t\t})\n\t\treturn\n\t}\n\t\n\t// 添加用户消息\n\tcontentList.value.push({\n\t\ttype: 'user',\n\t\ttext: information.value,\n\t\tcursorInex: false\n\t})\n\t\n\t// 滚动到底部\n\tscrollToBottom()\n\t\n\t// 保存输入内容并清空输入框\n\tconst userInput = information.value\n\tinformation.value = ''\n\t\n\t// 请求AI回复\n\taskAiRequest(userInput)\n}\n\nconst scrolList = (e) => {\n\told.value.scrollTop = e.detail.scrollTop\n}\n\nconst askAiRequest = (prompt) => {\n\t// 添加AI回复占位\n\tconst aiMessage = {\n\t\ttype: 'AI',\n\t\treply: '',\n\t\tshowText: '', // 显示的文字\n\t\tcursorInex: true,\n\t\ttypingComplete: false\n\t}\n\tcontentList.value.push(aiMessage)\n\tcurrentTypingIndex.value = contentList.value.length - 1\n\t\n\tscrollToBottom()\n\t\n\taskAi({ prompt: prompt }).then(res => {\n\t\tif (res.code === 200) {\n\t\t\tconst reply = res.data || '抱歉，未能获取回复内容'\n\t\t\t// 更新回复内容\n\t\t\tcontentList.value[currentTypingIndex.value].reply = reply\n\t\t\tcontentList.value[currentTypingIndex.value].cursorInex = false\n\t\t\tstartTypingEffect(currentTypingIndex.value)\n\t\t} else {\n\t\t\tthrow new Error(res.message || '请求失败')\n\t\t}\n\t}).catch(err => {\n\t\tconsole.error('请求出错:', err)\n\t\tcontentList.value[currentTypingIndex.value].reply = '抱歉，请求出错，请稍后再试'\n\t\tcontentList.value[currentTypingIndex.value].cursorInex = false\n\t\tstartTypingEffect(currentTypingIndex.value)\n\t})\n}\n\nconst startTypingEffect = (index) => {\n\tconst message = contentList.value[index]\n\tif (!message || message.typingComplete) return\n\t\n\t// 重置显示文本\n\tmessage.showText = ''\n\tlet currentCharIndex = 0\n\tconst fullText = message.reply\n\t\n\t// 清除之前的定时器\n\tif (message.typingTimer) {\n\t\tclearInterval(message.typingTimer)\n\t}\n\t\n\tmessage.typingTimer = setInterval(() => {\n\t\tif (currentCharIndex >= fullText.length) {\n\t\t\tclearInterval(message.typingTimer)\n\t\t\tmessage.typingComplete = true\n\t\t\treturn\n\t\t}\n\t\t\n\t\t// 更新当前消息的显示文本\n\t\tmessage.showText = fullText.substring(0, currentCharIndex + 1)\n\t\tcurrentCharIndex++\n\t\t\n\t\t// 触发视图更新\n\t\tcontentList.value = [...contentList.value]\n\t\t\n\t\t// 滚动到底部\n\t\tscrollToBottom()\n\t}, 20) // 速度加快\n}\n\nconst scrollToBottom = () => {\n\tnextTick(() => {\n\t\tscrollTop.value = old.value.scrollTop\n\t\tnextTick(() => {\n\t\t\tscrollTop.value = 999999\n\t\t})\n\t})\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.route-max {\n\twidth: 100%;\n\tbackground-size: cover;\n\tbackground-image: url('https://xnlv.lizxx.com/image/xnlv/static/yunzhanguan/yunzhanguanimage-49603.png');\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: relative;\n\tpadding-bottom: 120rpx; /* 为固定输入框留出空间 */\n\n\t.route-content-show {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tpadding: 20rpx;\n\t\tbox-sizing: border-box;\n\t\toverflow: hidden;\n\n\t\t.route-scroll-Y {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\toverflow-anchor: auto;\n\t\t\tpadding-bottom: 20rpx;\n\t\t}\n\t}\n\n\t/* 固定在底部的输入框容器 */\n\t.route-bottom-fixed {\n\t\tposition: fixed;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbackground-color: rgba(255, 255, 255, 0.9);\n\t\tpadding: 20rpx;\n\t\tbox-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.1);\n\t\tz-index: 100;\n\t}\n\n\t.route-user-box {\n\t\twidth: 100%;\n\t\tmargin-top: 20rpx;\n\t\tdisplay: flex;\n\t\tjustify-content: flex-end;\n\t\talign-items: flex-start;\n\n\t\t.route-input-box {\n\t\t\tmax-width: 70%;\n\t\t\tbackground-color: #ffffff;\n\t\t\tborder-radius: 20rpx 5rpx 20rpx 20rpx;\n\t\t\tmargin-right: 15rpx;\n\t\t\tmargin-top: 20rpx;\n\n\t\t\t.route-input-content {\n\t\t\t\tfont-size: 32rpx;\n\t\t\t\tcolor: #000;\n\t\t\t\tpadding: 20rpx;\n\t\t\t\tword-break: break-word;\n\t\t\t}\n\t\t}\n\n\t\timage {\n\t\t\tmargin-top: 20rpx;\n\t\t}\n\t}\n\n\t.route-Ai-box {\n\t\tdisplay: flex;\n\t\tmargin-top: 20rpx;\n\t\talign-items: flex-start;\n\n\t\timage {\n\t\t\tmargin-top: 20rpx;\n\t\t}\n\n\t\t.route-Ai-input {\n\t\t\tbackground-color: #ffffff;\n\t\t\tborder-radius: 5rpx 20rpx 20rpx 20rpx;\n\t\t\tmargin-left: 15rpx;\n\t\t\tmargin-top: 20rpx;\n\t\t\tmax-width: 70%;\n\n\t\t\t.smaa-user-cursor {\n\t\t\t\twidth: 4rpx;\n\t\t\t\theight: 30rpx;\n\t\t\t\tmargin: 20rpx;\n\t\t\t\tbackground-color: #000;\n\t\t\t\tanimation: loading 1s infinite;\n\t\t\t}\n\n\t\t\t@keyframes loading {\n\t\t\t\t0% {\n\t\t\t\t\topacity: 0.8;\n\t\t\t\t}\n\n\t\t\t\t100% {\n\t\t\t\t\topacity: 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t.route-Ai-content {\n\t\t\t\tfont-size: 32rpx;\n\t\t\t\tcolor: #000;\n\t\t\t\tpadding: 20rpx;\n\t\t\t\tword-break: break-word;\n\t\t\t\twhite-space: pre-wrap;\n\t\t\t}\n\t\t}\n\t}\n\n\t.route-bottom-box {\n\t\twidth: 100%;\n\t\theight: 100rpx;\n\t\tbackground-color: #ffffff;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tborder-radius: 75rpx;\n\t\tpadding: 0 25rpx;\n\t\tbox-sizing: border-box;\n\n\t\t.route-bottom-input {\n\t\t\tflex: 1;\n\t\t\theight: 70rpx;\n\t\t\tfont-size: 30rpx;\n\t\t\tcolor: #000;\n\t\t}\n\t}\n}\n\n</style>","import MiniProgramPage from 'D:/文档和照片/作业/大三下作业/集中实习/XiangVisionCampus/pages/ai/ai.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","onMounted","uni","askAi","nextTick"],"mappings":";;;;;;;;;;;;;;;AAoDA,UAAM,cAAcA,cAAG,IAAC,EAAE;AAC1B,UAAM,cAAcA,cAAG,IAAC,EAAE;AAC1B,UAAM,YAAYA,cAAG,IAAC,CAAC;AACvB,UAAM,MAAMA,cAAG,IAAC,EAAE,WAAW,EAAC,CAAE;AAChC,UAAM,eAAeA,cAAG,IAAC,CAAC;AAC1B,UAAM,qBAAqBA,cAAAA,IAAI,EAAE;AAIjC,UAAM,eAAeC,cAAQ,SAAC,MAAM;AAEnC,UAAI,UAAU;AACd,eAAS,IAAI,YAAY,MAAM,SAAS,GAAG,KAAK,GAAG,KAAK;AACvD,YAAI,YAAY,MAAM,CAAC,EAAE,SAAS,MAAM;AACvC,oBAAU;AACV;AAAA,QACA;AAAA,MACD;AAED,UAAI,YAAY;AAAG,eAAO;AAE1B,UAAI,YAAY;AAAI,eAAO,CAAC,CAAC,YAAY,MAAM,OAAO,EAAE;AAExD,aAAO;AAAA,IACR,CAAC;AAGDC,kBAAAA,UAAU,MAAM;AAEf,YAAM,aAAaC,cAAG,MAAC,cAAe;AACtC,mBAAa,QAAQ,WAAW;AAChC,cAAS;AAAA,IACV,CAAC;AAGD,UAAM,UAAU,MAAM;AAErB,kBAAY,MAAM,KAAK;AAAA,QACtB,MAAM;AAAA,QACN,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QACP,UAAU;AAAA;AAAA,QACV,YAAY;AAAA,QACZ,gBAAgB;AAAA;AAAA,MAClB,CAAE;AACD,wBAAkB,YAAY,MAAM,SAAS,CAAC;AAAA,IAC/C;AAEA,UAAM,eAAe,MAAM;AAC1B,UAAI,CAAC,YAAY,MAAM,QAAQ;AAC9BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,UACN,UAAU;AAAA,QACb,CAAG;AACD;AAAA,MACA;AAGD,kBAAY,MAAM,KAAK;AAAA,QACtB,MAAM;AAAA,QACN,MAAM,YAAY;AAAA,QAClB,YAAY;AAAA,MACd,CAAE;AAGD,qBAAgB;AAGhB,YAAM,YAAY,YAAY;AAC9B,kBAAY,QAAQ;AAGpB,mBAAa,SAAS;AAAA,IACvB;AAEA,UAAM,YAAY,CAAC,MAAM;AACxB,UAAI,MAAM,YAAY,EAAE,OAAO;AAAA,IAChC;AAEA,UAAM,eAAe,CAAC,WAAW;AAEhC,YAAM,YAAY;AAAA,QACjB,MAAM;AAAA,QACN,OAAO;AAAA,QACP,UAAU;AAAA;AAAA,QACV,YAAY;AAAA,QACZ,gBAAgB;AAAA,MAChB;AACD,kBAAY,MAAM,KAAK,SAAS;AAChC,yBAAmB,QAAQ,YAAY,MAAM,SAAS;AAEtD,qBAAgB;AAEhBC,cAAK,MAAC,EAAE,OAAgB,CAAA,EAAE,KAAK,SAAO;AACrC,YAAI,IAAI,SAAS,KAAK;AACrB,gBAAM,QAAQ,IAAI,QAAQ;AAE1B,sBAAY,MAAM,mBAAmB,KAAK,EAAE,QAAQ;AACpD,sBAAY,MAAM,mBAAmB,KAAK,EAAE,aAAa;AACzD,4BAAkB,mBAAmB,KAAK;AAAA,QAC7C,OAAS;AACN,gBAAM,IAAI,MAAM,IAAI,WAAW,MAAM;AAAA,QACrC;AAAA,MACH,CAAE,EAAE,MAAM,SAAO;AACfD,sBAAAA,MAAA,MAAA,SAAA,0BAAc,SAAS,GAAG;AAC1B,oBAAY,MAAM,mBAAmB,KAAK,EAAE,QAAQ;AACpD,oBAAY,MAAM,mBAAmB,KAAK,EAAE,aAAa;AACzD,0BAAkB,mBAAmB,KAAK;AAAA,MAC5C,CAAE;AAAA,IACF;AAEA,UAAM,oBAAoB,CAAC,UAAU;AACpC,YAAM,UAAU,YAAY,MAAM,KAAK;AACvC,UAAI,CAAC,WAAW,QAAQ;AAAgB;AAGxC,cAAQ,WAAW;AACnB,UAAI,mBAAmB;AACvB,YAAM,WAAW,QAAQ;AAGzB,UAAI,QAAQ,aAAa;AACxB,sBAAc,QAAQ,WAAW;AAAA,MACjC;AAED,cAAQ,cAAc,YAAY,MAAM;AACvC,YAAI,oBAAoB,SAAS,QAAQ;AACxC,wBAAc,QAAQ,WAAW;AACjC,kBAAQ,iBAAiB;AACzB;AAAA,QACA;AAGD,gBAAQ,WAAW,SAAS,UAAU,GAAG,mBAAmB,CAAC;AAC7D;AAGA,oBAAY,QAAQ,CAAC,GAAG,YAAY,KAAK;AAGzC,uBAAgB;AAAA,MAChB,GAAE,EAAE;AAAA,IACN;AAEA,UAAM,iBAAiB,MAAM;AAC5BE,oBAAAA,WAAS,MAAM;AACd,kBAAU,QAAQ,IAAI,MAAM;AAC5BA,sBAAAA,WAAS,MAAM;AACd,oBAAU,QAAQ;AAAA,QACrB,CAAG;AAAA,MACH,CAAE;AAAA,IACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1MA,GAAG,WAAW,eAAe;"}